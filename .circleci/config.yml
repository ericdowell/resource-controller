version: 2
jobs:
  build:
    docker:
      - image: ericdowell/laravel-circleci
    environment:
      TZ: "/usr/share/zoneinfo/America/Chicago"
    steps:
      - checkout
      - run:
          name: Install PHP Dependencies
          command: composer install --no-interaction --optimize-autoloader --prefer-dist
      - run:
          name: Run Unit Tests and Generate Code Coverage XML File
          command: composer test
      - store_test_results:
          path: build/junit
      - store_artifacts:
          path: build/junit
      - run: if [ -z ${CODECLIMATE_REPO_TOKEN+x} ]; then echo "CODECLIMATE_REPO_TOKEN not set"; else ./vendor/bin/test-reporter || echo 'Nothing sent, failed'; fi
